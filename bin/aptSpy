#!/bin/bash

# aptSpy

# apt install inotify-tools aptitude
# https://gist.github.com/fduran/1870502

# what file to monitor for changes
# /var/log/dpkg.log
file="/var/log/apt/history.log"

# exit if file is not there
[[ -f "$file" ]] || exit 0

# counter
count=0

# a function
status () {
    num=$(aptitude search "~U" | wc -l); if [ $num != 0 ]; then echo "$num"; fi
}

# spy and react
spy () {
    while inotifywait -e modify "$file" > /dev/null 2>&1 ; do

        ((count+=1))
        >&2 echo "something happened! $count" # should show in cli only and not in tint2
        
        status && >&2 echo "status inside loop"
        
    done 
}

# spy in background
spy & 

# and at some interval
while :
do
    status && >&2 echo "status on interval"
    sleep 3600

done
