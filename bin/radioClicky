#!/bin/bash

radio="http://wfmu.org/wfmu.pls"

on=" / "
off=" \\ "

pidPath="$HOME/tmp/radiopid"
mpvtxt="$HOME/tmp/mpv.txt"

mkdir -p "$HOME/tmp"

if [ "$1" == "toggle" ]; then

    if [ -f "$pidPath" ]; then
        Rpid=$(cat "$pidPath")
        kill "$Rpid" && rm "$pidPath"
        echo "$off" # off
    else
        mpv --no-video --no-resume-playback --no-ytdl --no-config  "$radio" > "$mpvtxt" 2>/dev/null &
        Rpid="$!"
        echo "$Rpid" > "$pidPath"
        echo "$on" # on
    fi
    
elif [ "$1" == "notify" ]; then

    icytitle="$(sed -n 's/^ icy-title: //p' "$mpvtxt" | tail -1)" && notify-send "$icytitle"

else # status

    if [ -f "$pidPath" ]; then
        echo "$on" # on
    else
        echo "$off" # off
    fi

fi


## tint2rc executor
#execp = new
#execp_centered = 1
#execp_has_icon = 0
#execp_command = radioClicky
#execp_continuous = 0
#execp_font = cuprum 12
#execp_font_color = #111111 70
#execp_padding = 0 0 0
#execp_tooltip = radio
#execp_lclick_command = radioClicky toggle
#execp_rclick_command = radioClicky notify
#execp_interval = 12
