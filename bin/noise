#!/bin/bash

# give me some noise

# checks
command -v convert >/dev/null 2>&1 || { echo "I need imagemagick convert, exiting." >&2; exit 1; }
command -v nitrogen >/dev/null 2>&1 || { echo "I need nitrogen, exiting." >&2; exit 1; }

# store & vars

file="/tmp/noise.png"
mx=1920; my=1200 ; mxsmall=$(( mx / 2 )) ; mysmall=$(( my / 2 ))

# fill colors

tilix="#263945" ; crunch="#222D32" ; deep="#0D314D" ; royal="#2842B3" ; adapta="#222D32" ; deep2="#192F49"

color="$tilix"

set -x

# action

# method one
#head -c "$((3*mx*my))" /dev/urandom | convert -depth 8 -size "${mx}x${my}" RGB:- -colorspace gray -fill "$color" +level 21%,24% -tint 100 -sharpen 0x1 "$file"

# method two
convert -size "${mx}x${my}" xc:"gray(50%)" -seed "${RANDOM}" -attenuate 2 +noise poisson -colorspace gray -fill "$color" +level 18%,28% -tint 100 -sharpen 0x1 "$file"

# https://www.imagemagick.org/script/command-line-options.php?ImageMagick=ogkomddlqbb40ivi7b0ocrddr4#noise

# method little disks
#convert -size "${mx}x${my}" xc:"gray(20%)" -seed "${RANDOM}" -attenuate 4 +noise poisson -colorspace gray -fill "$color" -define morphology:compose=Multiply -morphology Dilate Disk:6 -blur 0x3 +level 17%,45% -tint 100 "$file"

# method dots
#convert -size "${mxsmall}x${mysmall}" xc:"gray(50%)" -seed "${RANDOM}" -attenuate 26 +noise random -colorspace gray -fill "$color" -negate -adaptive-resize "${mx}x${my}" +level 18%,32% -tint 100 "$file"

# method dots and disks
#convert -size "${mxsmall}x${mysmall}" xc:"gray(50%)" -seed "${RANDOM}" -attenuate 26 +noise random -colorspace gray -fill "$color" -negate -adaptive-resize "${mx}x${my}" -define morphology:compose=Multiply -morphology Dilate Disk:6 -blur 0x3 +level 18%,32% -tint 100 "$file"  

# method multiple one
#convert \( -size "${mxsmall}x${mysmall}" xc:"gray(50%)" -seed "${RANDOM}" -attenuate 32 +noise random -colorspace gray -fill "$color" -negate -adaptive-resize "${mx}x${my}" -define morphology:compose=Multiply -morphology Dilate Disk:6 -blur 0x1 -adaptive-resize "${mxsmall}x${mysmall}" -adaptive-resize "${mx}x${my}" \) \
#-compose lineardodge \
#\( -size "${mx}x${my}" xc:"gray(50%)" -seed "${RANDOM}" -attenuate 2 +noise poisson -colorspace gray \) \
#-composite +level 18%,22% -tint 100 "$file"

# method dual noise
#convert \( -size "${mx}x${my}" xc:"gray(60%)" -seed "${RANDOM}" -attenuate 2 +noise gaussian  \) \
#-compose screen \
#\( -size "${mx}x${my}" xc:"gray(50%)" -seed "${RANDOM}" -attenuate 3 +noise poisson \) \
#-composite -negate -fill "$color" +level 18%,34% -tint 100 "$file"

nitrogen --set-tiled "$file"
