#!/bin/bash

# seen - This is a prototype script

# Do not display fortunes that were seen lately

# Usage examples:

# seen "string"
# seen "$(fortune -s cbbl)"
# until ./seen "$(fortune -s cbbl)" ; do : ; done
# until var="$(./seen "$(fortune -s cbbl)" 2>/dev/null)"; do : ; done && echo "$var"

store="$HOME/tmp"
cd "$store" || exit
touch "$store/hist.txt" # database

#set -x

#var="$(fortune -s cbbl)"

varorig="$1"
var="$(echo "${varorig@Q}" | tr -dc '[:alnum:]\n\r')"

# crop history
tail -n 50 hist.txt > tmp.txt || exit
rm hist.txt && mv tmp.txt hist.txt

# Notes: 
# - system would have to be aware that there is more than -n entries in the database
# - this 'database' certainly will not survive any kind of multi-call stuff

# compare
grep -q -f <(echo "$var") hist.txt
if [[ $? != 0 ]]; then

    echo "$varorig"
    echo "$var" >>  hist.txt || exit

else

    :
    #>&2 echo "$varorig"
    exit 1

fi
